<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>All Products ‚Äì Pet Shop</title>
    <link rel="stylesheet" href="S·∫£n ph·∫©m.css" />
    <style>
      html {
        scroll-behavior: smooth;
      }
      .category-list li {
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .category-list li.active {
        background-color: #f04593;
        color: white;
        border-radius: 5px;
      }
      .category-list li:hover:not(.active) {
        background-color: #fce4ec;
      }

      /* ƒê·∫£m b·∫£o th·∫ª link bassets/picture/webp/ao quanh kh√¥ng l√†m ƒë·ªïi m√†u ch·ªØ */
      .product-card-link {
        text-decoration: none;
        color: inherit;
        display: block;
        animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* CSS cho Modal */
      .modal-product-info {
        display: flex;
        gap: 20px;
        align-items: flex-start;
      }
      .quantity-control {
        display: flex;
        align-items: center;
        border: 1px solid #ddd;
        border-radius: 4px;
        width: fit-content;
      }
      .quantity-control button {
        border: none;
        background: #eee;
        padding: 5px 12px;
        cursor: pointer;
        font-size: 18px;
      }
      .quantity-control input {
        width: 40px;
        text-align: center;
        border: none;
        font-weight: bold;
      }
      .price-quantity-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-top: 15px;
      }
      .modal-total-price {
        color: #f04593;
        font-size: 20px;
        font-weight: 700;
      }
    </style>
  </head>
  <body>
    <section class="top-banner">
      <div class="banner-content">
        <h1 class="banner-title"><span>S·∫¢N</span> <span>PH·∫®M</span></h1>
        <p class="banner-desc">
          <b>M·ªói s·∫£n ph·∫©m b·∫°n ch·ªçn l√† m·ªôt b·ªØa ƒÉn, m·ªôt m√°i nh√†...</b> To√†n b·ªô l·ª£i
          nhu·∫≠n ƒë∆∞·ª£c d√πng ƒë·ªÉ c∆∞u mang th√∫ c∆∞ng.
        </p>
        <div class="banner-actions">
          <button
            class="btn-primary"
            onclick="document.querySelector('.content').scrollIntoView()"
          >
            Xem s·∫£n ph·∫©m
          </button>
          <button class="btn-outline">·ª¶ng h·ªô</button>
        </div>
      </div>
      <div class="banner-image">
        <img src="assets/picture/webp/toy.png" alt="Banner" />
      </div>
    </section>

    <div class="page">
      <aside class="sidebar">
        <ul class="category-list" id="categoryMenu">
          <li class="active" data-category="all">üêæ Danh m·ª•c s·∫£n ph·∫©m</li>
          <li data-category="Qu√† l∆∞u ni·ªám">üéÅ Qu√† l∆∞u ni·ªám</li>
          <li data-category="ƒê·ªì cho th√∫ c∆∞ng">üêï ƒê·ªì cho th√∫ c∆∞ng</li>
        </ul>
        <div class="member-box">
          <h4>M√£ khuy·∫øn m√£i m·ªõi</h4>
          <p class="promo-code" id="voucherCode">FRSS1234</p>
          <button class="promo-btn" onclick="copyVoucher()">Nh·∫≠n ngay</button>
        </div>
      </aside>

      <main class="content">
        <h1 id="categoryTitle">T·∫•t c·∫£ s·∫£n ph·∫©m</h1>
        <div class="product-grid"></div>
      </main>
    </div>

    <div id="cartModal" class="modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <div class="modal-header">
          <h2 style="font-size: 18px; margin: 0; font-weight: 700">
            Th√™m v√†o gi·ªè h√†ng
          </h2>
        </div>
        <div class="modal-body" id="modalBody"></div>
        <div class="modal-footer">
          <button class="btn-continue" onclick="closeModal()">
            Ti·∫øp t·ª•c mua h√†ng
          </button>
          <button class="btn-go-to-cart" onclick="goToPay()">
            Thanh to√°n ngay
          </button>
        </div>
      </div>
    </div>

    <script id="product-data" type="application/json">
      [
        {
          "id": 1,
          "name": "L·ªãch nƒÉm m·ªõi 2026 in h√¨nh m√®o d·ªÖ th∆∞∆°ng",
          "category": "Qu√† l∆∞u ni·ªám",
          "price": 45,
          "image": "assets/picture/webp/lich1.webp",
          "isNew": true
        },
        {
          "id": 2,
          "name": "M√≥c kh√≥a h√¨nh ch√≥ m√®o meme vui nh·ªôn",
          "category": "Qu√† l∆∞u ni·ªám",
          "price": 15,
          "image": "assets/picture/webp/moc4.webp",
          "isNew": false
        },
        {
          "id": 3,
          "name": "ghim c√†i √°o b·∫±ng b√¥ng h√¨nh m√®o ƒëen",
          "category": "Qu√† l∆∞u ni·ªám",
          "price": 23,
          "image": "assets/picture/webp/ghim1.webp",
          "isNew": false
        },
        {
          "id": 4,
          "name": "C·∫ßn c√¢u l√¥ng nhi·ªÅu m√†u ch∆°i ƒë√πa v·ªõi m√®o",
          "category": "ƒê·ªì cho th√∫ c∆∞ng",
          "price": 12,
          "image": "assets/picture/webp/cc1.webp",
          "isNew": true
        },
        {
          "id": 5,
          "name": "D√¢y g·∫∑m b·∫°n tennis 2 ƒë·∫ßu d√†nh cho ch√≥",
          "category": "ƒê·ªì cho th√∫ c∆∞ng",
          "price": 30,
          "image": "assets/picture/webp/can1.webp",
          "isNew": false
        },
        {
          "id": 6,
          "name": "√Åo gi·ªØ ·∫•m cho th√∫ c∆∞ng v√†o m√πa ƒë√¥ng",
          "category": "ƒê·ªì cho th√∫ c∆∞ng",
          "price": 50,
          "image": "assets/picture/webp/ao1.webp",
          "isNew": true
        }
      ]
    </script>

    <script>
      const products = JSON.parse(
        document.getElementById("product-data").textContent
      );
      const grid = document.querySelector(".product-grid");
      const categoryTitle = document.getElementById("categoryTitle");
      const menuItems = document.querySelectorAll("#categoryMenu li");
      let currentProduct = null;
      let currentQuantity = 1;

      // 1. H√†m Render s·∫£n ph·∫©m (ƒê√£ th√™m l·∫°i href ƒë·ªÉ v√†o trang chi ti·∫øt)
      function displayProducts(filterCategory) {
        grid.innerHTML = "";
        const filtered =
          filterCategory === "all"
            ? products
            : products.filter((p) => p.category === filterCategory);
        categoryTitle.innerText =
          filterCategory === "all" ? "T·∫•t c·∫£ s·∫£n ph·∫©m" : filterCategory;

        filtered.forEach((p) => {
          const html = `
        <a href="Chi ti·∫øt s·∫£n ph·∫©m.html?id=${p.id}" class="product-card-link">
          <div class="product">
            ${p.isNew ? `<span class="badge">NEW</span>` : ""}
            <img src="${p.image}" alt="${p.name}">
            <span class="tag">${p.category}</span>
            <div class="product-panels">
              <div class="panel panel-front">
                <h3 class="product-name">${p.name}</h3>
                <div class="price">${(p.price * 1000).toLocaleString(
                  "vi-VN"
                )} ƒë</div>
              </div>
              <div class="panel panel-back">
                <h3 class="product-name">${p.name}</h3>
                <div class="btn-buy" onclick="handleBuyClick(event, ${
                  p.id
                })">Mua ngay</div>
              </div>
            </div>
          </div>
        </a>
      `;
          grid.insertAdjacentHTML("beforeend", html);
        });
      }

      // 2. H√†m x·ª≠ l√Ω ri√™ng khi b·∫•m n√∫t Mua ngay ƒë·ªÉ kh√¥ng b·ªã nh·∫£y sang trang chi ti·∫øt
      function handleBuyClick(event, productId) {
        event.preventDefault(); // NgƒÉn ch·∫∑n th·∫ª <a> chuy·ªÉn h∆∞·ªõng
        event.stopPropagation(); // NgƒÉn s·ª± ki·ªán n·ªïi b·ªçt
        addToCart(productId);
      }

      function addToCart(productId) {
        currentProduct = products.find((p) => p.id === productId);
        currentQuantity = 1;
        renderModalContent();
        document.getElementById("cartModal").style.display = "block";
      }

      function renderModalContent() {
        const modalBody = document.getElementById("modalBody");
        const totalPrice = currentProduct.price * 1000 * currentQuantity;

        modalBody.innerHTML = `
        <div class="modal-product-info">
            <img src="${
              currentProduct.image
            }" width="120" style="border-radius:4px; border:1px solid #eee; object-fit: cover;">
            <div class="modal-product-details">
                <p style="margin:0; font-weight:700; font-size:18px;">${
                  currentProduct.name
                }</p>
                <p style="color: #666; font-size: 14px; margin: 5px 0;">ƒê∆°n gi√°: ${(
                  currentProduct.price * 1000
                ).toLocaleString("vi-VN")}ƒë</p>
                <div class="price-quantity-row">
                    <div class="quantity-control">
                        <button onclick="changeQty(-1)">‚àí</button>
                        <input type="text" id="modalQty" value="${currentQuantity}" readonly>
                        <button onclick="changeQty(1)">+</button>
                    </div>
                    <div style="text-align: right;">
                        <small style="color:#666;">T·ªïng c·ªông:</small>
                        <div class="modal-total-price">${totalPrice.toLocaleString(
                          "vi-VN"
                        )}ƒë</div>
                    </div>
                </div>
            </div>
        </div>
    `;
      }

      function changeQty(delta) {
        currentQuantity += delta;
        if (currentQuantity < 1) currentQuantity = 1;
        renderModalContent();
      }

      function closeModal() {
        document.getElementById("cartModal").style.display = "none";
      }

      // 3. H√†m l∆∞u v√† ƒëi t·ªõi trang thanh to√°n
      function goToPay() {
        if (!currentProduct) return;
        const itemToPay = {
          id: currentProduct.id,
          name: currentProduct.name,
          price: currentProduct.price,
          image: currentProduct.image,
          quantity: currentQuantity,
        };
        localStorage.setItem("cart", JSON.stringify([itemToPay]));
        window.location.href = "pay.html";
      }

      // 4. C√°c s·ª± ki·ªán ph·ª•
      menuItems.forEach((item) => {
        item.addEventListener("click", function () {
          menuItems.forEach((i) => i.classList.remove("active"));
          this.classList.add("active");
          displayProducts(this.getAttribute("data-category"));
        });
      });

      function copyVoucher() {
        const codeText = document.getElementById("voucherCode").innerText;
        navigator.clipboard.writeText(codeText).then(() => {
          const btn = document.querySelector(".promo-btn");
          btn.innerText = "ƒê√£ sassets/picture/webp/ao ch√©p! ‚úì";
          setTimeout(() => {
            btn.innerText = "Nh·∫≠n ngay";
          }, 2000);
        });
      }

      window.onclick = function (event) {
        let modal = document.getElementById("cartModal");
        if (event.target == modal) closeModal();
      };

      displayProducts("all");
    </script>
  </body>
</html>
